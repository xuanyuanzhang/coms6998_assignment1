<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="index.css">
    <!--<script src="index.js"></script>-->

    <title>chatbot</title>
    <style>
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            padding-top: 60px;
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #C5DDEB;
            margin: 5% auto 15% auto; /* 5% from the top, 15% from the bottom and centered */
            border: 1px solid #888;
            height: 50%;
            width: 80%; /* Could be more or less, depending on screen size */
        }

        .animate {
            -webkit-animation: animatezoom 0.6s;
            animation: animatezoom 0.6s
        }

        @-webkit-keyframes animatezoom {
            from {-webkit-transform: scale(0)}
            to {-webkit-transform: scale(1)}
        }

        @keyframes animatezoom {
            from {transform: scale(0)}
            to {transform: scale(1)}
        }

    </style>
</head>

<body>
    <div id="id01" class="modal">
        <div class="modal-content animate">
            <div class="container" style="width:800px; adding-top: 20px; border: 10px">
                <label for="uname"><b>Username</b></label>
                <input type="text" placeholder="Enter Username" name="uname" required>

                <label for="psw"><b>Password</b></label>
                <input type="password" placeholder="Enter Password" name="psw" required>

                <button onclick="submit()">Login</button>
            </div>

            <div class="container" style="background-color:#C5DDEB; width:800px; padding-top: 20px;">
                <button type="button" onclick="document.getElementById('id01').style.display='none'" class="cancelbtn">Cancel</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="chat-header">
            <!--<img src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/chat_avatar_01_green.jpg"/>-->
            <div id="signin_message" class="chat-with">please sign in to chat with our bot~</div>
            <div class="chat-num-messages">Already 4 messages.
                <button id="signin_btn" onclick="document.getElementById('id01').style.display='block'" style="width:auto;"> sign in </button>
            </div>

        </div>
    <!-- end chat-header -->
        <div class="chat-history">
            <ul class="tb" id="content">
                <li dir="rtl">
                    <div class="message-data align-right" dir="ltr">
                        <span class="message-data-time" >10:10 AM, Today</span> &nbsp; &nbsp;
                        <span class="message-data-name" >Olia</span>
                    </div>
                    <div class="message other-message float-right" dir="ltr">
                        Hi Bot, how are you?
                    </div>

                </li>

                <li>
                    <div class="message-data">
                        <span class="message-data-name"><i class="online"></i>Bot</span>
                        <span class="message-data-time">10:12 AM, Today</span>
                    </div>
                    <div class="message my-message">
                        Fine thank you, and you?
                    </div>
                </li>

                <li dir="rtl">
                    <div class="message-data align-right" dir="ltr">
                        <span class="message-data-time" >10:14 AM, Today</span> &nbsp; &nbsp;
                        <span class="message-data-name" >Olia</span>
                    </div>
                    <div class="message other-message float-right" dir="ltr">
                        I am fine too.
                    </div>
                </li>

                <li>
                    <div class="message-data">
                        <span class="message-data-name"><i class="online"></i>Bot</span>
                        <span class="message-data-time">10:20 AM, Today</span>
                    </div>
                    <div class="message my-message">
                        Actually everything was fine.
                    </div>
                </li>
            </ul>

        </div> <!-- end chat-history -->

        <div class="chat-message">
            <textarea name="message-to-send" id="message-to-send" placeholder ="Type your message" rows="3"></textarea>

            <i class="fa fa-file-o"></i> &nbsp;&nbsp;&nbsp;
            <i class="fa fa-file-image-o"></i>

            <button onclick="apiCall()">Send</button>

        </div> <!-- end chat-message -->

    </div> <!-- end chat -->

</body>

<!-- This part is for API -->
<script type="text/javascript" src="lib/axios/dist/axios.standalone.js"></script>
<script type="text/javascript" src="lib/CryptoJS/rollups/hmac-sha256.js"></script>
<script type="text/javascript" src="lib/CryptoJS/rollups/sha256.js"></script>
<script type="text/javascript" src="lib/CryptoJS/components/hmac.js"></script>
<script type="text/javascript" src="lib/CryptoJS/components/enc-base64.js"></script>
<script type="text/javascript" src="lib/url-template/url-template.js"></script>
<script type="text/javascript" src="lib/apiGatewayCore/sigV4Client.js"></script>
<script type="text/javascript" src="lib/apiGatewayCore/apiGatewayClient.js"></script>
<script type="text/javascript" src="lib/apiGatewayCore/simpleHttpClient.js"></script>
<script type="text/javascript" src="lib/apiGatewayCore/utils.js"></script>
<script type="text/javascript" src="apigClient.js"></script>

<script>
    var apigClient = apigClientFactory.newClient({
        accessKey: '',
        secretKey: '',
        sessionToken: '',
        region: ''
    });
    var sign_in = false;

    var modal = document.getElementById('id01');

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    }

    function signIn(access_Key, secret_Key, session_Token, Region) {
        apigClient = apigClientFactory.newClient({
            accessKey: access_Key,
            secretKey: secret_Key,
            sessionToken: session_Token,
            region: Region
        });
        sign_in = true;
        document.getElementById("signin_message").textContent= "Welcome!";
    }

    function apiCall() {
        // if not sign in, do not do anything
        if (!sign_in) {
            return;
        }

        var text = document.getElementById("message-to-send").value;
        var user = "Anonymous";
        create_and_append_question(user, text);

        <!-- Here is for API connection part -->


        var apigClient = apigClientFactory.newClient({
          accessKey: 'AKIAJ6JIXWR5HE7JOTNQ',
          secretKey: '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'
        });
        //var params ;

        var body = {
            "messages": [
                {
                    "type": "string",
                    "unstructured": {
                        "id": user,
                        "text": text,
                        "timestamp": "2010-02-22"
                    }
                }
            ]
        };

        var additionalParams = {
          // If there are any unmodeled query parameters or headers that must be
          //   sent with the request, add them here.
          headers: {
            param0: '',
            param1: ''
          },
          queryParams: {
            param0: '',
            param1: ''
          }
        };
        apigClient.chatbotPost(body)
            .then(function(result){
                console.log(result);
                receive_and_append_answer(result["data"]["messages"][0]["unstructured"]["text"])
            }).catch( function(result){
                console.log(result);
                receive_and_append_answer("api call error")
        });
        document.getElementById("message-to-send").value = "";
    }

    function create_and_append_question(usr, txt) {
        var p = document.createElement("li");
        p.setAttribute("dir", "rtl");
        var child1 = document.createElement("div");
        child1.setAttribute("class", "message-data align-right");
        child1.setAttribute("dir", "ltr");
        var time = document.createElement("span");
        time.setAttribute("class", "message-data-time");
        time.appendChild(document.createTextNode("10:14 AM, Today"));
        time.innerHTML += '&nbsp; &nbsp;';
        var user = document.createElement("span");
        user.setAttribute("class", "message-data-name");
        user.appendChild(document.createTextNode(usr));
        child1.appendChild(time);
        child1.appendChild(user);
        var child2 = document.createElement("div");
        child2.setAttribute("class", "message other-message float-right");
        child2.setAttribute("dir", "ltr");
        child2.appendChild(document.createTextNode(txt));
        p.appendChild(child1);
        p.appendChild(child2);
        var curr = document.getElementById("content");
        curr.appendChild(p);
    }

    function receive_and_append_answer(txt) {
        var p = document.createElement("li");
        var child1 = document.createElement("div");
        child1.setAttribute("class", "message-data");
        var time = document.createElement("span");
        time.setAttribute("class", "message-data-time");
        time.appendChild(document.createTextNode("10:14 AM, Today"));
        var bot = document.createElement("span");
        bot.setAttribute("class", "message-data-name");
        bot.appendChild(document.createTextNode("Bot"));
        child1.appendChild(bot);
        child1.appendChild(time);
        var child2 = document.createElement("div");
        child2.setAttribute("class", "message my-message");
        child2.appendChild(document.createTextNode(txt));
        p.appendChild(child1);
        p.appendChild(child2);
        var curr = document.getElementById("content");
        curr.appendChild(p);
    }
</script>
</html>